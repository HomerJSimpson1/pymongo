// restore config server
// NOTE:  I figured out after a few tries that I had to be in the gene_backup directory and then issue
// restore "config_server", NOT in the config_server directory trying to restore "config"
C:\Users\petersj\Downloads\gene_backup>mongorestore config_server

// Output from above:

 Directory of C:\Users\petersj\Downloads\gene_backup\config_server

07/10/2016  02:25 PM    <DIR>          .
07/10/2016  02:25 PM    <DIR>          ..
07/10/2016  02:25 PM    <DIR>          config
               0 File(s)              0 bytes
               3 Dir(s)  110,407,385,088 bytes free

C:\Users\petersj\Downloads\gene_backup\config_server>mongorestore --port 27001 c
onfig
2016-07-10T20:08:24.199-0400    Failed: error connecting to db server: no reacha
ble servers

C:\Users\petersj\Downloads\gene_backup\config_server>mongorestore config
2016-07-10T20:13:29.484-0400    building a list of dbs and collections to restor
e from config dir
2016-07-10T20:13:29.485-0400    don't know what to do with file "config\actionlo
g.bson", skipping...
2016-07-10T20:13:29.486-0400    don't know what to do with file "config\actionlo
g.metadata.json", skipping...
2016-07-10T20:13:29.487-0400    don't know what to do with file "config\changelo
g.bson", skipping...
2016-07-10T20:13:29.487-0400    don't know what to do with file "config\changelo
g.metadata.json", skipping...
2016-07-10T20:13:29.488-0400    don't know what to do with file "config\chunks.b
son", skipping...
2016-07-10T20:13:29.488-0400    don't know what to do with file "config\chunks.m
etadata.json", skipping...
2016-07-10T20:13:29.489-0400    don't know what to do with file "config\collecti
ons.bson", skipping...
2016-07-10T20:13:29.489-0400    don't know what to do with file "config\collecti
ons.metadata.json", skipping...
2016-07-10T20:13:29.490-0400    don't know what to do with file "config\database
s.bson", skipping...
2016-07-10T20:13:29.491-0400    don't know what to do with file "config\database
s.metadata.json", skipping...
2016-07-10T20:13:29.491-0400    don't know what to do with file "config\lockping
s.bson", skipping...
2016-07-10T20:13:29.492-0400    don't know what to do with file "config\lockping
s.metadata.json", skipping...
2016-07-10T20:13:29.492-0400    don't know what to do with file "config\locks.bs
on", skipping...
2016-07-10T20:13:29.493-0400    don't know what to do with file "config\locks.me
tadata.json", skipping...
2016-07-10T20:13:29.493-0400    don't know what to do with file "config\mongos.b
son", skipping...
2016-07-10T20:13:29.494-0400    don't know what to do with file "config\mongos.m
etadata.json", skipping...
2016-07-10T20:13:29.494-0400    don't know what to do with file "config\settings
.bson", skipping...
2016-07-10T20:13:29.495-0400    don't know what to do with file "config\settings
.metadata.json", skipping...
2016-07-10T20:13:29.496-0400    don't know what to do with file "config\shards.b
son", skipping...
2016-07-10T20:13:29.496-0400    don't know what to do with file "config\shards.m
etadata.json", skipping...
2016-07-10T20:13:29.497-0400    don't know what to do with file "config\system.i
ndexes.bson", skipping...
2016-07-10T20:13:29.497-0400    don't know what to do with file "config\tags.bso
n", skipping...
2016-07-10T20:13:29.498-0400    don't know what to do with file "config\tags.met
adata.json", skipping...
2016-07-10T20:13:29.498-0400    don't know what to do with file "config\version.
bson", skipping...
2016-07-10T20:13:29.499-0400    don't know what to do with file "config\version.
metadata.json", skipping...
2016-07-10T20:13:29.499-0400    done

C:\Users\petersj\Downloads\gene_backup\config_server>mongorestore --drop --oplog
Replay config
2016-07-10T21:33:20.538-0400    building a list of dbs and collections to restor
e from config dir
2016-07-10T21:33:20.539-0400    don't know what to do with file "config\actionlo
g.bson", skipping...
2016-07-10T21:33:20.539-0400    don't know what to do with file "config\actionlo
g.metadata.json", skipping...
2016-07-10T21:33:20.539-0400    don't know what to do with file "config\changelo
g.bson", skipping...
2016-07-10T21:33:20.539-0400    don't know what to do with file "config\changelo
g.metadata.json", skipping...
2016-07-10T21:33:20.539-0400    don't know what to do with file "config\chunks.b
son", skipping...
2016-07-10T21:33:20.539-0400    don't know what to do with file "config\chunks.m
etadata.json", skipping...
2016-07-10T21:33:20.539-0400    don't know what to do with file "config\collecti
ons.bson", skipping...
2016-07-10T21:33:20.539-0400    don't know what to do with file "config\collecti
ons.metadata.json", skipping...
2016-07-10T21:33:20.540-0400    don't know what to do with file "config\database
s.bson", skipping...
2016-07-10T21:33:20.540-0400    don't know what to do with file "config\database
s.metadata.json", skipping...
2016-07-10T21:33:20.541-0400    don't know what to do with file "config\lockping
s.bson", skipping...
2016-07-10T21:33:20.541-0400    don't know what to do with file "config\lockping
s.metadata.json", skipping...
2016-07-10T21:33:20.542-0400    don't know what to do with file "config\locks.bs
on", skipping...
2016-07-10T21:33:20.542-0400    don't know what to do with file "config\locks.me
tadata.json", skipping...
2016-07-10T21:33:20.542-0400    don't know what to do with file "config\mongos.b
son", skipping...
2016-07-10T21:33:20.543-0400    don't know what to do with file "config\mongos.m
etadata.json", skipping...
2016-07-10T21:33:20.544-0400    don't know what to do with file "config\settings
.bson", skipping...
2016-07-10T21:33:20.544-0400    don't know what to do with file "config\settings
.metadata.json", skipping...
2016-07-10T21:33:20.545-0400    don't know what to do with file "config\shards.b
son", skipping...
2016-07-10T21:33:20.545-0400    don't know what to do with file "config\shards.m
etadata.json", skipping...
2016-07-10T21:33:20.545-0400    don't know what to do with file "config\system.i
ndexes.bson", skipping...
2016-07-10T21:33:20.546-0400    don't know what to do with file "config\tags.bso
n", skipping...
2016-07-10T21:33:20.546-0400    don't know what to do with file "config\tags.met
adata.json", skipping...
2016-07-10T21:33:20.547-0400    don't know what to do with file "config\version.
bson", skipping...
2016-07-10T21:33:20.547-0400    don't know what to do with file "config\version.
metadata.json", skipping...
2016-07-10T21:33:20.548-0400    Failed: error scanning filesystem: no config/opl
og.bson file to replay; make sure you run mongodump with --oplog

C:\Users\petersj\Downloads\gene_backup\config_server>cd ..

C:\Users\petersj\Downloads\gene_backup>mongorestore config_server
2016-07-10T21:33:58.094-0400    building a list of dbs and collections to restor
e from config_server dir
2016-07-10T21:33:58.098-0400    reading metadata for config.actionlog from confi
g_server\config\actionlog.metadata.json
2016-07-10T21:33:58.098-0400    reading metadata for config.changelog from confi
g_server\config\changelog.metadata.json
2016-07-10T21:33:58.099-0400    reading metadata for config.chunks from config_s
erver\config\chunks.metadata.json
2016-07-10T21:33:58.100-0400    reading metadata for config.locks from config_se
rver\config\locks.metadata.json
2016-07-10T21:33:58.120-0400    restoring config.actionlog from config_server\co
nfig\actionlog.bson
2016-07-10T21:33:58.140-0400    restoring config.changelog from config_server\co
nfig\changelog.bson
2016-07-10T21:33:58.159-0400    restoring config.chunks from config_server\confi
g\chunks.bson
2016-07-10T21:33:58.179-0400    restoring indexes for collection config.chunks f
rom metadata
2016-07-10T21:33:58.180-0400    restoring config.locks from config_server\config
\locks.bson
2016-07-10T21:33:58.180-0400    restoring indexes for collection config.actionlo
g from metadata
2016-07-10T21:33:58.181-0400    restoring indexes for collection config.changelo
g from metadata
2016-07-10T21:33:58.235-0400    finished restoring config.chunks (2 documents)
2016-07-10T21:33:58.236-0400    restoring indexes for collection config.locks fr
om metadata
2016-07-10T21:33:58.236-0400    finished restoring config.changelog (11 document
s)
2016-07-10T21:33:58.238-0400    finished restoring config.actionlog (114 documen
ts)
2016-07-10T21:33:58.238-0400    reading metadata for config.databases from confi
g_server\config\databases.metadata.json
2016-07-10T21:33:58.239-0400    reading metadata for config.shards from config_s
erver\config\shards.metadata.json
2016-07-10T21:33:58.239-0400    reading metadata for config.lockpings from confi
g_server\config\lockpings.metadata.json
2016-07-10T21:33:58.276-0400    finished restoring config.locks (3 documents)
2016-07-10T21:33:58.277-0400    reading metadata for config.collections from con
fig_server\config\collections.metadata.json
2016-07-10T21:33:58.309-0400    restoring config.databases from config_server\co
nfig\databases.bson
2016-07-10T21:33:58.341-0400    restoring config.shards from config_server\confi
g\shards.bson
2016-07-10T21:33:58.375-0400    restoring config.lockpings from config_server\co
nfig\lockpings.bson
2016-07-10T21:33:58.405-0400    restoring indexes for collection config.shards f
rom metadata
2016-07-10T21:33:58.408-0400    restoring indexes for collection config.lockping
s from metadata
2016-07-10T21:33:58.410-0400    restoring indexes for collection config.database
s from metadata
2016-07-10T21:33:58.412-0400    restoring config.collections from config_server\
config\collections.bson
2016-07-10T21:33:58.437-0400    finished restoring config.shards (2 documents)
2016-07-10T21:33:58.440-0400    reading metadata for config.mongos from config_s
erver\config\mongos.metadata.json
2016-07-10T21:33:58.465-0400    finished restoring config.lockpings (2 documents
)
2016-07-10T21:33:58.468-0400    restoring indexes for collection config.collecti
ons from metadata
2016-07-10T21:33:58.470-0400    finished restoring config.databases (3 documents
)
2016-07-10T21:33:58.472-0400    reading metadata for config.version from config_
server\config\version.metadata.json
2016-07-10T21:33:58.474-0400    reading metadata for config.settings from config
_server\config\settings.metadata.json
2016-07-10T21:33:58.501-0400    finished restoring config.collections (1 documen
t)
2016-07-10T21:33:58.503-0400    restoring config.mongos from config_server\confi
g\mongos.bson
2016-07-10T21:33:58.505-0400    reading metadata for config.tags from config_ser
ver\config\tags.metadata.json
2016-07-10T21:33:58.532-0400    restoring config.version from config_server\conf
ig\version.bson
2016-07-10T21:33:58.559-0400    restoring config.settings from config_server\con
fig\settings.bson
2016-07-10T21:33:58.586-0400    restoring indexes for collection config.settings
 from metadata
2016-07-10T21:33:58.588-0400    restoring indexes for collection config.mongos f
rom metadata
2016-07-10T21:33:58.590-0400    restoring indexes for collection config.version
from metadata
2016-07-10T21:33:58.591-0400    finished restoring config.settings (1 document)
2016-07-10T21:33:58.592-0400    restoring config.tags from config_server\config\
tags.bson
2016-07-10T21:33:58.594-0400    finished restoring config.mongos (1 document)
2016-07-10T21:33:58.596-0400    finished restoring config.version (1 document)
2016-07-10T21:33:58.597-0400    restoring indexes for collection config.tags fro
m metadata
2016-07-10T21:33:58.626-0400    finished restoring config.tags (0 documents)
2016-07-10T21:33:58.626-0400    done




// Start up config server
mongod --configsvr --dbpath config_server\config

// Start up mongo shell for config server
mongo localhost:27019/config

// NOTE: I was unable to see any collections when I was in this mongo shell.
// However, when I was connected to a regular mongod instance using a regular mongo shell,
// I was able to see the config database and the collections inside, so I used that to make the
// changes as per the directions in the final exam.

> show dbs
blog      0.000GB
config    0.000GB
enron     0.215GB
local     0.000GB
pcat      0.000GB
school    0.000GB
students  0.000GB
test      0.002GB
video     0.001GB
> use config
switched to db config
> show collections
actionlog
changelog
chunks
collections
databases
lockpings
locks
mongos
settings
shards
tags
version
> db.chunks.find()
{ "_id" : "snps.elegans-snp_\"haw100000\"", "lastmod" : Timestamp(2, 1), "lastmo
dEpoch" : ObjectId("553f0ef319d7841961ac8fc1"), "ns" : "snps.elegans", "min" : {
 "snp" : "haw100000" }, "max" : { "snp" : { "$maxKey" : 1 } }, "shard" : "s1" }
{ "_id" : "snps.elegans-snp_MinKey", "lastmod" : Timestamp(2, 0), "lastmodEpoch"
 : ObjectId("553f0ef319d7841961ac8fc1"), "ns" : "snps.elegans", "min" : { "snp"
: { "$minKey" : 1 } }, "max" : { "snp" : "haw100000" }, "shard" : "s2" }
> db.chunks.find().sort({_id:1}).next().lastmodEpoch.getTimestamp().toUTCString(
).substr(20,6)
39:15
> db.shards.find()
{ "_id" : "s1", "host" : "s1/genome_svr1:27501,genome_svr2:27502,genome_svr2:275
03" }
{ "_id" : "s2", "host" : "s2/genome_svr4:27601,genome_svr5:27602,genome_svr5:276
03" }


// Update of shards:



// Output:

C:\Users\petersj>mongo
2016-07-11T08:00:08.861-0400 I CONTROL  [main] Hotfix KB2731284 or later update
is not installed, will zero-out data files
MongoDB shell version: 3.2.6
connecting to: test
> show dbs
blog      0.000GB
config    0.000GB
enron     0.215GB
local     0.000GB
pcat      0.000GB
school    0.000GB
students  0.000GB
test      0.002GB
video     0.001GB
> use config
switched to db config
> show collections
actionlog
changelog
chunks
collections
databases
lockpings
locks
mongos
settings
shards
tags
version
> db.shards.find9)
2016-07-11T08:00:22.640-0400 E QUERY    [thread1] SyntaxError: missing ; before
statement @(shell):1:15

> db.shards.find()
{ "_id" : "s1", "host" : "s1/genome_svr1:27501,genome_svr2:27502,genome_svr2:275
03" }
{ "_id" : "s2", "host" : "s2/genome_svr4:27601,genome_svr5:27602,genome_svr5:276
03" }
> db.shards.update({_id:"s1"}, {"host":"localhost:27501"})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
> db.shards.update({_id:"s2"}, {"host":"localhost:27601"})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
> db.shards.find()
{ "_id" : "s1", "host" : "localhost:27501" }
{ "_id" : "s2", "host" : "localhost:27601" }
> exit
bye



// Start up the mongo server for s1
mongod --shardsvr --dbpath s1 --port 27501 --smallfiles --oplogSize 50

// Start up the mongo server for s2
mongod --shardsvr --dbpath s2 --port 27601 --smallfiles --oplogSize 50


// Restore shards s1 and s2
// I didn't execute these statements, but thought about it, since I never did --oplogReplay when restoring the config_server
mongorestore --drop --port 27019 --oplogreplay config_server
mongorestore --port 27501 --oplogReplay s1
mongorestore --port 27601 --oplogReplay s2


// Instead, I used these statements....
mongorestore --port 27501 s1
mongorestore --port 27601 s2


// Okay, those didn't work, so these finally did.  Hope these are right....
mongorestore -d finalexam -c snps --port 27501 s1\snps\elegans.bson
mongorestore -d finalexam -c snps --port 27601 s2\snps\elegans.bson
